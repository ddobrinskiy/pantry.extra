distributable:
  url: https://gitlab.com/gitlab-org/cli/-/archive/v{{version}}/cli-v{{version}}.tar.gz
  strip-components: 1

versions:
  - 1.26.0

provides:
  - bin/glab

build:
  script: |
    go mod download
    # go build -v -ldflags="$LDFLAGS"
    mkdir -p "{{ prefix }}"/bin
    go build -v -trimpath -ldflags "$(LDFLAGS)" -o $(BUILDLOC) "{{ prefix }}"/bin/glab #FIXME are buildloc and prefix/bin/glab accurate?
    ls
    ls "{{ prefix }}"/bin
  dependencies:
    go.dev: ^1.18
    #FIXME should be this but we didnâ€™t build 1.17 yet
    # go.dev: ~1.17
  env:
    GO111MODULE: on
    BUILDLOC: {{prefix}}/cmd/glab
      - -s
      - -w
      - -X main.buildDate='2023-03-27' #FIXME get build date from shell
      - -X main.version={{ version }}
      - -X main.platform={{ platform }} #FIXME is this correct?
      - -X main.debugMode=true"

    linux:
      # or segmentation fault
      # fix found here https://github.com/docker-library/golang/issues/402#issuecomment-982204575
      LDFLAGS:
      - -buildmode=pie

test:
  glab --version
  #FIXME add test for actual functionality
